#!/bin/bash

exit_status=0

cd $SNAP_USER_COMMON

$SNAP/bin/mycroft-messagebus &
bus_pid=$?

$SNAP/bin/start_skills &
skills_pid=$?

$SNAP/bin/mycroft-enclosure-client &
enclosure_pid=$?

$SNAP/bin/start_useraudio &
audio_pid=$?

$SNAP/bin/mycroft-speech-client &
speech_pid=$?

cleanup() {
    kill $bus_pid
    kill $skills_pid
    kill $enclosure_pid
    kill $audio_pid
    kill $speech_pid
    exit $exit_status
}

trap cleanup INT TERM

/bin/sleep infinity
#mycroft-cli-client
# If the script exits on its own something went wrong.
# Exit with this exit code.
exit_status=$?
cleanup